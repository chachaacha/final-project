<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="potato.manager.review">
	
	<select id="selectReview" resultType="potato.manager.domain.ReviewDomain" >
		select re.restarea_idx, ra.name, re.contents, re.rating, re.id, re.post_date, (select count(ID_REPORTER) from report where REVIEW_IDX = re.REVIEW_IDX and ID_WRITER=re.ID and RESTAREA_IDX = re.RESTAREA_IDX  ) report_cnt
		from review re, restarea ra
		
		<where>
		(re.restarea_idx = ra.restarea_idx) and 1=1
		<if test="keyword != null and keyword != ''">
		<if test="searchType != null">
		and ${searchType} like '%'||#{keyword}||'%'
		</if>
		</if>
		</where>
		
		<if test="dateOrderFlag != 0">
		<choose>
		<when test="dateOrderFlag != 1">
		order by re.post_date desc
		</when>
		<otherwise>
		order by re.post_date
		</otherwise>
		</choose>
		</if>
		
		<if test="reportOrderFlag != 0">
		<choose>
		<when test="reportOrderFlag != 1">
		order by report_cnt desc
		</when>
		<otherwise>
		order by report_cnt
		</otherwise>
		</choose>
		</if>
		offset (#{pageFlag}-1)*15 rows
		fetch next 15 rows only
	</select>

</mapper>